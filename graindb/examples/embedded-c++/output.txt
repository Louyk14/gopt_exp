select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 30786325579101 and p_personid = k_person2id and p_firstname = 'Ian'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 30786325579101       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Ian'       and p_personid != 30786325579101     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 30786325579101       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Ian'       and p_personid != 30786325579101     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 24189255811707 and p_personid = k_person2id and p_firstname = 'Jun'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 24189255811707       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Jun'       and p_personid != 24189255811707     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 24189255811707       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Jun'       and p_personid != 24189255811707     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 26388279067358 and p_personid = k_person2id and p_firstname = 'Jun'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 26388279067358       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Jun'       and p_personid != 26388279067358     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 26388279067358       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Jun'       and p_personid != 26388279067358     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 17592186044737 and p_personid = k_person2id and p_firstname = 'Jun'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 17592186044737       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Jun'       and p_personid != 17592186044737     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 17592186044737       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Jun'       and p_personid != 17592186044737     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 32985348834036 and p_personid = k_person2id and p_firstname = 'Adriaen'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 32985348834036       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Adriaen'       and p_personid != 32985348834036     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 32985348834036       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Adriaen'       and p_personid != 32985348834036     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 32985348834013 and p_personid = k_person2id and p_firstname = 'Claribel'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 32985348834013       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Claribel'       and p_personid != 32985348834013     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 32985348834013       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Claribel'       and p_personid != 32985348834013     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 2199023256919 and p_personid = k_person2id and p_firstname = 'Ahmad Rafiq'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 2199023256919       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Ahmad Rafiq'       and p_personid != 2199023256919     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 2199023256919       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Ahmad Rafiq'       and p_personid != 2199023256919     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 19791209300317 and p_personid = k_person2id and p_firstname = 'Geremi Sorele Njitap'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 19791209300317       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Geremi Sorele Njitap'       and p_personid != 19791209300317     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 19791209300317       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Geremi Sorele Njitap'       and p_personid != 19791209300317     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 2199023256097 and p_personid = k_person2id and p_firstname = 'Karl'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 2199023256097       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Karl'       and p_personid != 2199023256097     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 2199023256097       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Karl'       and p_personid != 2199023256097     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 26388279066931 and p_personid = k_person2id and p_firstname = 'Eugene'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 26388279066931       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Eugene'       and p_personid != 26388279066931     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 26388279066931       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Eugene'       and p_personid != 26388279066931     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 10995116277882 and p_personid = k_person2id and p_firstname = 'John'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 10995116277882       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'John'       and p_personid != 10995116277882     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 10995116277882       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'John'       and p_personid != 10995116277882     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 6597069767668 and p_personid = k_person2id and p_firstname = 'Mihai'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 6597069767668       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Mihai'       and p_personid != 6597069767668     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 6597069767668       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Mihai'       and p_personid != 6597069767668     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 8796093023655 and p_personid = k_person2id and p_firstname = 'Mike'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 8796093023655       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Mike'       and p_personid != 8796093023655     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 8796093023655       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Mike'       and p_personid != 8796093023655     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 15393162789696 and p_personid = k_person2id and p_firstname = 'Mike'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 15393162789696       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Mike'       and p_personid != 15393162789696     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 15393162789696       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Mike'       and p_personid != 15393162789696     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

select   id,   p_lastname,   min (dist) as dist,   p_birthday,   p_creationdate,   p_gender,   p_browserused,   p_locationip,   (select string_agg(pe_email, ';') from person_email where pe_personid = id group by pe_personid) as emails,   (select string_agg(plang_language, ';') from person_language where plang_personid = id group by plang_personid) as languages,   p1.pl_name,   (select string_agg(o2.o_name || '|' || pu_classyear::text || '|' || p2.pl_name, ';')      from person_university, organisation o2, place p2     where pu_personid = id and pu_organisationid = o2.o_organisationid and o2.o_placeid = p2.pl_placeid     group by pu_personid) as university,   (select string_agg(o3.o_name || '|' || pc_workfrom::text  || '|' || p3.pl_name, ';')      from person_company, organisation o3, place p3     where pc_personid = id and pc_organisationid = o3.o_organisationid and o3.o_placeid = p3.pl_placeid     group by pc_personid) as company from     (     select k_person2id as id, 1 as dist from knows, person where k_person1id = 454 and p_personid = k_person2id and p_firstname = 'Karl'     union all     select b.k_person2id as id, 2 as dist from knows a, knows b, person     where a.k_person1id = 454       and b.k_person1id = a.k_person2id       and p_personid = b.k_person2id       and p_firstname = 'Karl'       and p_personid != 454     union all     select c.k_person2id as id, 3 as dist from knows a, knows b, knows c, person     where a.k_person1id = 454       and b.k_person1id = a.k_person2id       and b.k_person2id = c.k_person1id       and p_personid = c.k_person2id       and p_firstname = 'Karl'       and p_personid != 454     ) tmp, person, place p1   where     p_personid = id and     p_placeid = p1.pl_placeid   group by id, p_lastname, p_birthday, p_creationdate, p_gender, p_browserused, p_locationip, p1.pl_name   order by dist, p_lastname, id   limit 20 ; 

